<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="/admin/fragments/head :: head">
</head>
<body>
<div th:replace="/admin/fragments/header :: nav"></div>
<div class="section">
  <div class="container">
    <div class="row">
      <div th:replace="/admin/fragments/leftMenu :: menu"></div>
      <div id="fixed-table-toolbar--buttons" class="pull-left search">
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addNewModal">
          Add new Client
        </button>
      </div>
      <div class="col-md-10 display-grid">

        <table id="users_table" data-class="table table-striped table-hover"
               data-pagination="true" data-side-pagination="client" data-search="true" data-query-params="queryParams"
               data-sort-name="id" data-show-refresh="true" data-url="/api/clients">
          <thead>
          <tr>
            <th data-field="id" data-formatter="idFormatter"  data-sortable="true">Id</th>
            <th data-field="fullName" data-sortable="true">Full Name</th>
          </tr>
          </thead>
        </table>

      </div>
    </div>
  </div>
</div>

<div id="feedback"></div>
<div class="modal fade" id="addNewModal" tabindex="-1" role="dialog" aria-labelledby="addNewModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
          aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="addNewModalLabel">Add new Client</h4>
      </div>
      <div class="modal-body">
        <form id="register-form" role="form" class="form-horizontal" th:action="@{/create}" th:method="post">
          <div class="form-group">
            <div class="col-sm-2">
              <label for="create-firstName" class="control-label">First name</label>
            </div>
            <div class="col-sm-10">
              <input type="text" name="firstName" id="create-firstName" tabindex="1" class="form-control"
                     placeholder="First name" value=""/>
            </div>
          </div>
          <div class="form-group">
            <div class="col-sm-2">
              <label for="create-lastName" class="control-label">Last name</label>
            </div>
            <div class="col-sm-10">
              <input type="text" name="lastName" id="create-lastName" tabindex="1" class="form-control"
                     placeholder="Last name" value=""/>
            </div>
          </div>
          <output id="addNewFormErrors"></output>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button id="register-submit-button" type="button" class="btn btn-primary"
                onclick="$('#register-form').submit();">Create Client
        </button>
      </div>
    </div>
  </div>
</div>

<script th:inline="javascript">
  /*<![CDATA[*/
  $(document).ready(function () {

    $('#users_table').bootstrapTable({
      url: '/api/clients',
      columns: [{
        field: 'id',
        title: 'Id',
        formatter: function (value) {
          return '<a href="/admin/clients/' + value + '">' + value + '</a>';
        }
      },
        {
          field: 'fullName',
          title: 'Full Name',
          formatter: function (value, row) {
            return [row.firstName, row.lastName].join(' ');
          }
        }]
    });

    $('#fixed-table-toolbar--buttons').prependTo('.fixed-table-toolbar');

    $("#register-form").submit(function (event) {
      event.preventDefault();
      submit_new_user_form_ajax();
    });
  });

  function submit_new_user_form_ajax() {

    var client = {};
    client["firstName"] = $("#create-firstName").val();
    client["lastName"] = $("#create-lastName").val();

    $("#register-submit-button").prop("disabled", true);

    $.ajax({
      type: "POST",
      contentType: "application/json",
      url: "/api/clients/create",
      data: JSON.stringify(client),
      dataType: 'json',
      cache: false,
      timeout: 600000,
      success: function (data) {
        document.location.href="/admin/clients/" + data.id;
      },
      error: function (e) {
        console.log(e);
        $("#addNewFormErrors").text(e);
        $("#register-submit-button").prop("disabled", false);
      }
    });

  }

  /*]]>*/
</script>

</body>
</html>
